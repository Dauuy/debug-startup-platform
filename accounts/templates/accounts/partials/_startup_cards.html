{% load file_tags %}
{% load static %}
{% load humanize %}

{% for startup in page_obj %}
  <div class="startup-card">
    <span class="startup-franchise-tag">Франшиза</span>
    <div class="startup-card-inner">
      <div class="startup-image">
        {% if startup.logo_urls %}
          <img src="{% get_file_url_tag startup.logo_urls.0 startup.startup_id 'logo' %}" alt="{{ startup.title }}">
        {% else %}
          <div class="startup-image-placeholder">
            {{ startup.title|make_list|first|upper }}
          </div>
        {% endif %}
      </div>

      <h3 class="startup-name">{{ startup.title }}</h3>

      <div class="startup-rating-comments">
        <span class="rating-text">Рейтинг {{ startup.average_rating|floatformat:1 }}/5 ({{ startup.total_voters }})</span>
        <span class="comments-count">
          <i class="far fa-comment"></i>
          {{ startup.comments.count|default:0 }}
        </span>
      </div>

      {% with progress=startup.get_progress_percentage|default:0 %}
      <div class="progress-container">
        <div class="progress-bar-visual" data-progress="{{ progress|floatformat:0 }}">
          {% if progress > 0 %}
            <div class="progress-animation-container">
            <div class="progress-planets">
            </div>
          </div>
          <span class="progress-percentage">{{ progress|floatformat:0 }}%</span>
          {% else %}
             <span class="progress-percentage">0%</span>
          {% endif %}
        </div>
        <div class="investor-count">
          <i class="fas fa-users"></i>
          <span>({{ startup.get_investors_count }})</span>
        </div>
      </div>
      {% endwith %}

      <div class="investment-type">
        {% if startup.both_mode %}Инвестирование+Выкуп{% elif startup.only_invest %}Только инвестирование{% elif startup.only_buy %}Только выкуп{% else %}Тип не указан{% endif %}
      </div>

      <div class="funding-goal-info">
        Цель: {{ startup.funding_goal|default:"0"|floatformat:0|intcomma }} ₽
      </div>

      <div class="startup-description">
        {{ startup.description|truncatewords:15 }}
      </div>

      <a href="{% url 'startup_detail' startup.startup_id %}" class="detail-link">
        {# Текст не нужен #}
      </a>
    </div>
  </div>
{% endfor %} 