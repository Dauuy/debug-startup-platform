{% extends 'accounts/base.html' %}
{% load static %}
{% load widget_tweaks %}
{% load file_tags %}
{% load timeline_filters %}
{% load humanize %}
{% load accounts_extras %}

{% block title %}{{ startup.title }} - Подробности{% endblock %}

{% block head_extra %}
  <link rel="stylesheet" href="{% static 'accounts/css/startup_detail_styles.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  {# LightGallery CSS #}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery.min.css" integrity="sha512-F2E+YYE1gkt0T5TVajAslgDfTEUQKtlu4ralVqXRruimwriteJzqHZzcWjtFgVs9HIJNnhgaf/9cXHuSinAE1QA=" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-thumbnail.min.css" integrity="sha512-GRxDpj/bx6/I4U6h4YUEFQeKBOAbvcFXNWCentAyS1TcvdKrtdH2XdinjQGyk3h3G4gdXIOeiJ5LP4TOfqESew==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-video.min.css" integrity="sha512-89gDQOHnYjji90NPJ7+M5OmoNgaRpVQyQxinUwGbhMQA1+PLjMk+HqPPYqVImuZTBCLgtcNhtzkjwRkSGPFItw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}

{% block content %}
<div class="startup-detail-page">
  <div class="main-content-grid">
    <div class="back-link-container">
      <a href="{% url 'startups_list' %}" class="back-button">
        <i class="fas fa-arrow-left"></i> Назад
      </a>
    </div>

    <div class="detail-content">
      <div class="top-section">
        <div class="left-column">
          <div class="planet-container">
            {% if user.is_authenticated and user.role.role_name == 'moderator' %}
              <form method="post" class="status-form">
                {% csrf_token %}
                <select name="status" class="status-select" onchange="this.form.submit()">
                  <option value="approved" {% if startup.status == 'approved' %}selected{% endif %}>Активен</option>
                  <option value="blocked" {% if startup.status == 'blocked' %}selected{% endif %}>Blocked</option>
                  <option value="closed" {% if startup.status == 'closed' %}selected{% endif %}>Closed</option>
                </select>
              </form>
            {% else %}
              {% if startup.status == 'approved' %}
                <div class="status-badge">Активен</div>
              {% elif startup.status == 'blocked' %}
                <div class="status-badge">Blocked</div>
              {% elif startup.status == 'closed' %}
                <div class="status-badge">Closed</div>
              {% endif %}
            {% endif %}
            
            {% if startup.logo_urls %}
              <img src="{% get_file_url_tag logo_urls.0 startup.startup_id 'logo' %}" alt="Логотип" class="logo-preview">
            {% else %}
              <div class="planet">
                <div class="planet-segment segment-top" style="background-color: {{ startup.planet_top_color|default:'#7B61FF' }};"></div>
                <div class="planet-segment segment-middle" style="background-color: {{ startup.planet_middle_color|default:'#6B51DF' }};"></div>
                <div class="planet-segment segment-bottom" style="background-color: {{ startup.planet_bottom_color|default:'#5B41BF' }};"></div>
              </div>
            {% endif %}
            <button class="action-button chat-button">Чат</button>
          </div>
          
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill" data-progress="{{ progress_percentage|default:0 }}" style="width: {{ progress_percentage|default:0 }}%;"></div>
            </div>
            <div class="progress-info">
              <span class="progress-percentage">{{ progress_percentage|default:0|floatformat:0 }}%</span>
              <span class="progress-backers">({{ investors_count }})</span>
            </div>
          </div>
          
          <div class="author-info-left">
            <div class="author-header">Автор</div>
            <div class="author-details">
              <div class="author-avatar">
                {# <img src="{{ startup.owner.avatar_url }}" alt="{{ startup.owner.first_name }}"> #}
              </div>
              <div class="author-meta">
                <div class="author-name">{{ startup.owner.first_name|default:"Виктор" }}</div>
                <div class="author-rating">Рейтинг {{ average_rating|floatformat:"1" }}/5</div>
                {# <div class="author-reviews">Отзывы</div> #}
              </div>
              <button class="action-button write-author-button">Написать</button>
            </div>
            <div class="creation-date">Создан {{ startup.created_at|date:"d/m/Y" }}</div>
            <button class="report-button">Пожаловаться</button>
          </div>
        </div>
        
        <div class="right-column">
          <div class="startup-header">
            <h1 class="startup-name">{{ startup.title }}</h1>
            <div class="header-meta">
              <span class="category-label">Категория: <span class="category-value">{{ startup.direction.direction_name|default:"Медицина" }}</span></span>
              <span class="investment-type">
                <i class="fas fa-check-circle"></i> Микроинвестиции
              </span>
            </div>
            <div class="rating-comments-container">
              <div class="rating-container">
                <span class="rating-label">Рейтинг: {{ average_rating|floatformat:"1" }}/5</span>
                <div class="rating-stars" data-rating="{{ average_rating|default:0 }}" {% if user.is_authenticated and not user_has_voted %}data-startup-id="{{ startup.startup_id }}"{% endif %}>
                  {% for i in "12345" %}
                    <i class="fas fa-star {% if forloop.counter <= average_rating|floatformat:0 %}active{% endif %}" {% if user.is_authenticated and not user_has_voted %}data-rating="{{ forloop.counter }}"{% endif %}></i>
                  {% endfor %}
                </div>
              </div>
              <a href="#comments-section" class="comments-link">Комментарии</a>
            </div>
          </div>

          <div class="actions-top-right">
            <div class="investment-info-badge">Инвестирование: Выкуп</div>
            {% if user.is_authenticated and startup.owner == user %}
              <button class="action-button edit-button">Редактировать</button>
              <button class="action-button sell-button primary">Продать активы</button>
            {% elif user.is_authenticated and user.role.role_name == 'investor' %}
              <button class="action-button invest-button primary" 
                      {% if startup.status == 'blocked' or startup.status == 'closed' %}
                        disabled 
                        title="{% if startup.status == 'blocked' %}Инвестирование запрещено: стартап заблокирован{% else %}Инвестирование запрещено: стартап закрыт{% endif %}"
                      {% endif %}>
                Инвестировать
              </button>
              <input type="number" class="investment-amount" placeholder="Сумма, ₽" min="0" step="1000">
            {% endif %}
          </div>

          <div class="info-blocks">
            <div class="info-block presentation-block">
              <i class="fas fa-file-alt icon"></i>
              <span class="info-block-title">Презентация</span>
              {% if startup.pitch_deck_url %}
                <a href="{{ startup.pitch_deck_url }}" target="_blank" class="action-button view-button">Смотреть</a>
              {% else %}
                <button class="action-button view-button" disabled>Смотреть</button>
              {% endif %}
            </div>
            <div class="info-block collected-sum-block">
              <i class="fas fa-coins icon"></i>
              <span class="info-block-title">Собранная сумма</span>
              <span class="info-block-value">{{ startup.total_invested|default:0|floatformat:0|intcomma }} ₽</span>
            </div>
          </div>

          <div class="about-section">
            <h2 class="section-title">Вводная</h2>
            <p class="section-content short-description">
              {{ startup.description|truncatewords:30 }}
            </p>
            <h2 class="section-title">О проекте</h2>
            <div class="section-content full-description">
              {{ startup.description|linebreaksbr }}
              {% if startup.additional_info %}
                <p><strong>Основные функции:</strong></p>
                {{ startup.additional_info|linebreaksbr }}
              {% endif %}
            </div>
          </div>

          {# Секция Креативов и Видео #}
          <div class="media-section">
            {# Выводим сначала видео, если есть #}
            {% if video_urls %}
            <div class="video-gallery" id="lightgallery-video"> 
                {% for url in video_urls %}
                {# LightGallery требует ссылку <a> с data-src для видео #}
                <a href="{% get_file_url_tag url startup.startup_id 'video' %}" 
                   data-lg-size="1280-720" {# Пример размера, можно убрать или настроить #}
                   data-video='{"source": [{"src":"{% get_file_url_tag url startup.startup_id 'video' %}", "type":"video/mp4"}], "attributes": {"preload": false, "playsinline": true, "controls": true}}' 
                   class="video-thumbnail">
                    <div class="play-icon"><i class="fas fa-play"></i></div>
                </a>
                {% endfor %}
            </div>
            {% endif %}

            {# Выводим креативы (изображения) #}
            {% if creatives_urls %}
            <div class="image-gallery" id="lightgallery-images">
                {% for url in creatives_urls %}
                <a href="{% get_file_url_tag url startup.startup_id 'creative' %}" 
                   data-lg-size="1600-1200" {# Пример размера #}
                   class="gallery-thumbnail" 
                   data-sub-html="<h4>Креатив {{ forloop.counter }}</h4>">
                    <img src="{% get_file_url_tag url startup.startup_id 'creative' %}" alt="Креатив {{ forloop.counter }}" class="thumbnail-img"/>
                </a>
                {% endfor %}
            </div>
            {% endif %}

            {# Если нет ни видео, ни креативов #}
            {% if not video_urls and not creatives_urls %}
                <p>Дополнительные медиа-материалы отсутствуют.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <div id="comments-section" class="comments-section">
        <div class="comments-header">
          <h2 class="section-title">Комментарии <span class="comments-count">({{ comments|length }})</span></h2>
          <div class="comments-rating-summary">
            <span class="average-rating-value">{{ average_rating|default:0|floatformat:"1" }}</span>
            <div class="rating-distribution">
              {% for i in "54321" %}
              <div class="rating-bar-container">
                <span class="star-label">{{ i }} <i class="fas fa-star"></i></span>
                <div class="rating-bar">
                  <div class="rating-bar-fill" style="width: {{ rating_distribution|get_item:i|default:0 }}%;"></div>
                </div>
                <span class="rating-count">{{ rating_counts|get_item:i|default:0 }}</span>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        {% if user.is_authenticated %}
          <form method="post" class="comment-form">
            {% csrf_token %}
            {{ form.content|add_class:"comment-textarea"|attr:"placeholder:Полность комментария..." }}
            <button type="submit" class="action-button comment-submit primary">Оставить комментарий</button>
          </form>
        {% else %}
          <div class="comment-form">
            <p>Пожалуйста, <a href="{% url 'login' %}">войдите</a>, чтобы оставить комментарий.</p>
          </div>
        {% endif %}

        {% if comments %}
          <div class="comments-list">
            {% for comment in comments %}
              <div class="comment-card {% if forloop.counter > 3 %}hidden{% endif %}">
                <div class="comment-header">
                  <div class="comment-author-info">
                    <div class="comment-author-avatar"></div>
                    <div class="comment-author-name">{{ comment.user_id.first_name|default:comment.user_id.email }}</div>
                  </div>
                  <div class="comment-rating">
                    {% with comment_rating=comment.rating|default:0 %}
                    {% for star_i in "12345" %}
                      <i class="fas fa-star {% if star_i|add:"0" <= comment_rating %}active{% endif %}"></i>
                    {% endfor %}
                    {% endwith %}
                  </div>
                  <div class="comment-date">{{ comment.created_at|date:"d/m/Y" }}</div>
                </div>
                <div class="comment-body">
                  <p>{{ comment.content }}</p>
                </div>
                <div class="comment-footer">
                  {% if comment.user_id|has_invested:startup %}
                    <span class="badge badge-invested">Инвестировал</span>
                  {% endif %}
                  {% if comment.user_id|is_buyout_investor:startup %}
                    <span class="badge badge-buyout">Выкуп</span>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
            
            {% if comments|length > 3 %}
              <button class="show-more-comments">
                Показать еще <i class="fas fa-chevron-down"></i>
              </button>
              <button class="hide-comments-button" style="display: none;">
                Скрыть <i class="fas fa-chevron-up"></i>
              </button>
            {% endif %}
          </div>
        {% else %}
          <div class="comments-list">
            <p>Пока нет комментариев. Будьте первым!</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="similar-startups-section">
  <div class="similar-startups-container">
    <h2 class="similar-title">
      <span class="similar-text">похожие</span>
      <span class="startups-text">СТАРТАПЫ</span>
    </h2>
    
    <a href="{% url 'startups_list' %}" class="show-all-button">
      <span>Показать все</span> <i class="fas fa-arrow-right"></i>
    </a>
    
    <div class="similar-startups-grid">
      {% for similar in similar_startups|slice:":5" %}
      <a href="{% url 'startup_detail' similar.startup_id %}" class="similar-card">
        <div class="similar-card-image">
          {% if similar.logo_urls %}
            <img src="{% get_file_url_tag similar.logo_urls.0 similar.startup_id 'logo' %}" alt="Логотип">
          {% else %}
            <div class="planet">
              <div class="planet-segment segment-top" style="background-color: {{ similar.planet_top_color|default:'#7B61FF' }};"></div>
              <div class="planet-segment segment-middle" style="background-color: {{ similar.planet_middle_color|default:'#6B51DF' }};"></div>
              <div class="planet-segment segment-bottom" style="background-color: {{ similar.planet_bottom_color|default:'#5B41BF' }};"></div>
            </div>
          {% endif %}
        </div>
        <div class="similar-card-name">{{ similar.title|default:"Ромашка" }}</div>
        <div class="similar-card-rating">
          {% with sim_rating=similar.average_rating|default:0 %}
          {% for i in "12345" %}
            <i class="fas fa-star {% if forloop.counter <= sim_rating|floatformat:0 %}active{% endif %}"></i>
          {% endfor %}
          {% endwith %}
        </div>
        <div class="similar-card-category">
          <div class="category-badge">{{ similar.direction.direction_name|default:"Медицина" }}</div>
        </div>
      </a>
      {% empty %}
        {% for i in "12345" %}
        <a href="#" class="similar-card placeholder">
          <div class="similar-card-image"><div class="planet"></div></div>
          <div class="similar-card-name">Название стартапа</div>
          <div class="similar-card-rating">
            <i class="fas fa-star active"></i><i class="fas fa-star active"></i><i class="fas fa-star active"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
          </div>
          <div class="similar-card-category"><div class="category-badge">Категория</div></div>
        </a>
        {% endfor %}
      {% endfor %}
    </div>
  </div>
</div>

<div id="investModal" class="modal">
  <div class="modal-content">
    <h2>Подтверждение инвестиции</h2>
    <p id="modalText"></p>
    <div class="modal-buttons">
      <button class="confirm-btn" id="confirmInvest">Подтвердить</button>
      <button class="cancel-btn" id="cancelInvest">Отменить</button>
    </div>
  </div>
</div>

<div id="lightbox" class="lightbox">
  <span class="close-lightbox">×</span>
  <div class="lightbox-content">
    <img id="lightbox-img" />
    <video id="lightbox-video" controls></video>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const progressFill = document.querySelector('.progress-fill');
    const progressPercentageSpan = document.querySelector('.progress-percentage');
    if (progressFill && progressPercentageSpan) {
      const initialProgress = parseFloat(progressFill.getAttribute('data-progress')) || 0;
      progressFill.style.width = `${initialProgress}%`;
      progressPercentageSpan.textContent = `${Math.round(initialProgress)}%`;
    }

    const ratingStarsDisplay = document.querySelector('.rating-stars[data-rating]');
    if (ratingStarsDisplay) {
      const rating = parseFloat(ratingStarsDisplay.getAttribute('data-rating')) || 0;
      const stars = ratingStarsDisplay.querySelectorAll('i');
      stars.forEach((star, index) => {
        star.classList.toggle('active', index < Math.round(rating));
      });
    }

    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    const lightboxVideo = document.getElementById('lightbox-video');
    const closeLightbox = document.querySelector('.close-lightbox');
    
    document.querySelectorAll('.lightbox-trigger').forEach(item => {
      item.addEventListener('click', function(e) {
        e.preventDefault();
        lightboxImg.src = this.href;
        lightboxImg.style.display = 'block';
        lightboxVideo.style.display = 'none';
        lightboxVideo.pause(); 
        lightbox.style.display = 'flex';
      });
    });
    
    document.querySelectorAll('.lightbox-trigger-video').forEach(item => {
      item.addEventListener('click', function(e) {
        e.preventDefault();
        const videoSource = this.querySelector('video source');
        if(videoSource) {
            lightboxVideo.src = videoSource.src;
            lightboxVideo.load();
            lightboxVideo.style.display = 'block';
            lightboxImg.style.display = 'none';
            lightbox.style.display = 'flex';
        }
      });
    });
    
    if (closeLightbox) {
        closeLightbox.addEventListener('click', function() {
        lightbox.style.display = 'none';
        lightboxVideo.pause();
        });
    }
    
    if (lightbox) {
        lightbox.addEventListener('click', function(e) {
        if (e.target === lightbox) {
            lightbox.style.display = 'none';
            lightboxVideo.pause();
        }
        });
    }
    
    const showMoreCommentsBtn = document.querySelector('.show-more-comments');
    const hideCommentsBtn = document.querySelector('.hide-comments-button');
    const commentCards = document.querySelectorAll('.comment-card');
    const commentsToShow = 3;
    
    if (showMoreCommentsBtn && hideCommentsBtn && commentCards.length > commentsToShow) {
      showMoreCommentsBtn.addEventListener('click', function() {
        commentCards.forEach((comment, index) => {
          if (index >= commentsToShow) {
             comment.classList.remove('hidden');
          }
        });
        this.style.display = 'none';
        hideCommentsBtn.style.display = 'inline-flex';
      });
    
      hideCommentsBtn.addEventListener('click', function() {
        commentCards.forEach((comment, index) => {
          if (index >= commentsToShow) {
            comment.classList.add('hidden');
          }
        });
        this.style.display = 'none';
        showMoreCommentsBtn.style.display = 'inline-flex';
      });
    } else if (showMoreCommentsBtn) {
        showMoreCommentsBtn.style.display = 'none'; 
    }

    document.querySelectorAll('.rating-stars[data-startup-id] i[data-rating]').forEach(star => {
      star.addEventListener('click', function() {
        const rating = this.getAttribute('data-rating');
        const startupId = this.closest('.rating-stars').getAttribute('data-startup-id');
        const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
        
        if (!startupId || !csrfToken) {
            console.error("Не найден startupId или CSRF токен для голосования.");
            return;
        }

        fetch(`/vote/${startupId}/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': csrfToken
          },
          body: `rating=${rating}`
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
             const starsContainer = this.closest('.rating-stars');
             if (starsContainer) {
                 starsContainer.removeAttribute('data-startup-id');
                 const stars = starsContainer.querySelectorAll('i');
                 stars.forEach((s, index) => {
                     s.classList.toggle('active', index < Math.round(data.average_rating));
                     s.removeAttribute('data-rating');
                 });
                 const ratingValueElement = document.querySelector('.rating-label');
                 if (ratingValueElement) {
                     ratingValueElement.textContent = `Рейтинг: ${data.average_rating.toFixed(1)}/5`;
                 }
                 const commentAvgRating = document.querySelector('.comments-rating-summary .average-rating-value');
                 if (commentAvgRating) {
                    commentAvgRating.textContent = data.average_rating.toFixed(1);
                 }
             }
          } else {
            alert(data.error || 'Ошибка при голосовании');
          }
        })
        .catch(error => {
          console.error('Ошибка:', error);
          alert('Произошла ошибка при голосовании');
        });
      });
    });

    // Обработчик клика по кнопке "Инвестировать"
    const investButton = document.querySelector('.invest-button');
    const modal = document.getElementById('investModal');
    const modalText = document.getElementById('modalText');
    const confirmInvest = document.getElementById('confirmInvest');
    const cancelInvest = document.getElementById('cancelInvest');
    let investAmount = 0;
    let investStartupId = 0;

    if (investButton && !investButton.disabled) {
      console.log('Кнопка "Инвестировать" найдена и активна');
      investButton.addEventListener('click', function() {
        const amountInput = document.querySelector('.investment-amount');
        investAmount = amountInput.value;
        const ratingStarsElement = document.querySelector('.rating-stars');
        const startupElementForId = document.querySelector('[data-startup-id]');
        if (startupElementForId) {
            investStartupId = startupElementForId.getAttribute('data-startup-id');
        } else {
            investStartupId = '{{ startup.startup_id|default:0 }}';
            console.warn("Не удалось найти data-startup-id на странице, используется ID из Django.");
        }
        console.log('Сумма:', investAmount, 'Startup ID:', investStartupId);

        if (!investAmount || investAmount <= 0) {
          alert('Пожалуйста, введите сумму инвестиций больше 0');
          console.log('Сумма некорректна');
          return;
        }

        // Показать модальное окно
        const formattedAmount = parseFloat(investAmount).toLocaleString('ru-RU');
        modalText.innerHTML = `Вы собираетесь инвестировать ${formattedAmount} ₽ в стартап \"{{ startup.title|escapejs }}\". Подтвердите действие.`;
        modal.style.display = 'flex';
      });
    } else {
      console.log('Кнопка "Инвестировать" либо не найдена, либо неактивна');
    }

    // Обработка клика на кнопку подтверждения в модальном окне
    confirmInvest.addEventListener('click', function() {
      modal.style.display = 'none';
      // Отправка AJAX запроса на инвестирование
      fetch(`/invest/${investStartupId}/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'X-CSRFToken': getCookie('csrftoken')
        },
        body: `amount=${investAmount}`
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Обновление данных на странице
          const progressBarFill = document.querySelector('.progress-bar-fill');
          const progressText = document.querySelector('.progress-text');
          const investorsCountElement = document.querySelector('.investors-count span');
          const totalInvestedElement = document.querySelector('.total-invested');

          if (progressBarFill) {
              progressBarFill.style.width = `${Math.round(data.progress_percentage)}%`;
          }
          if (progressText) {
              progressText.textContent = `${Math.round(data.progress_percentage)}%`;
          }

          if (investorsCountElement) {
              investorsCountElement.textContent = `(${data.investors_count})`;
          }

          if (totalInvestedElement) {
            const formattedRaised = parseFloat(data.amount_raised).toLocaleString('ru-RU');
            totalInvestedElement.textContent = `${formattedRaised} ₽`;
          }

          const amountInput = document.querySelector('.investment-amount');
          if (amountInput) amountInput.value = '';

          alert('Инвестиция успешно совершена!');
        } else {
          alert('Ошибка инвестирования: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Ошибка:', error);
        alert('Произошла ошибка сети.');
      });
    });

    // Отмена инвестиции
    cancelInvest.addEventListener('click', function() {
      modal.style.display = 'none';
    });

    // Закрытие модального окна по клику вне области
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Инициализация LightGallery
    const galleryImages = document.getElementById('lightgallery-images');
    if (galleryImages) {
        lightGallery(galleryImages, {
            plugins: [lgThumbnail],
            thumbnail: true,
            selector: 'a',
            licenseKey: 'YOUR_LICENSE_KEY', // TODO: Добавьте ваш ключ, если есть
            speed: 500,
            download: false
            // Другие опции: https://www.lightgalleryjs.com/docs/settings/
        });
    }

    const galleryVideo = document.getElementById('lightgallery-video');
    if (galleryVideo) {
        lightGallery(galleryVideo, {
            plugins: [lgVideo],
            selector: 'a', // Видео-ссылки
            licenseKey: 'YOUR_LICENSE_KEY', // TODO: Добавьте ваш ключ, если есть
            download: false
            // Видео опции: https://www.lightgalleryjs.com/docs/video-gallery/
        });
    }
  });
</script>
{# LightGallery JS #}
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js" integrity="sha512-dSI4QnNeaXiNEjX2N8bkb16B7aMu/8SI5/rE6NIa3Hr/HnWUO+EazpSG5eaeOrqrLzPGXLAcHJcXjaBQC4fhPg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/thumbnail/lg-thumbnail.min.js" integrity="sha512-VBbe8aA3HXUn0cfkgId76XvbN8Tm7Q7CP+TRJStTzsU7/GNXGvNKqmcwMbljKj4KonEWsyKzChpldR5YRpNCJg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/video/lg-video.min.js" integrity="sha512-mjbaEgQDBAmMn8XF16574cNKJ/YATB6K8YfMRA5HZ7GgG8Y599XaXfHwXy5N3y3DLS33AlDhmT7cdY/EM3YJfw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{% endblock %}