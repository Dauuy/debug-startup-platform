{% extends 'accounts/base.html' %}
{% load static %}
{% load widget_tweaks %}
{% load file_tags %}
{% load timeline_filters %}  <!-- Загружаем кастомный фильтр -->

{% block title %}{{ startup.title }} - Подробности{% endblock %}

{% block head_extra %}
  <link rel="stylesheet" href="{% static 'accounts/css/startup_detail_styles.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="startup-detail-page">
  <!-- Кнопка назад -->
  <a href="{% url 'startups_list' %}" class="back-button">
    <i class="fas fa-arrow-left"></i>
  </a>

  <div class="detail-content">
    <!-- Верхняя информация -->
    <div class="form-row">
      <div class="form-column">
        <!-- Планета/Логотип -->
        <div class="planet-container">
          {% if startup.logo_urls %}
            <img src="{% get_file_url_tag logo_urls.0 startup.startup_id 'logo' %}" alt="Логотип" class="logo-preview">
          {% else %}
            <div class="planet">
              <div class="planet-segment segment-top" style="background-color: {{ startup.planet_top_color|default:'#7B61FF' }};"></div>
              <div class="planet-segment segment-middle" style="background-color: {{ startup.planet_middle_color|default:'#6B51DF' }};"></div>
              <div class="planet-segment segment-bottom" style="background-color: {{ startup.planet_bottom_color|default:'#5B41BF' }};"></div>
            </div>
          {% endif %}
          
          {% if startup.status == 'approved' %}
          <div class="status-badge">Активен</div>
          {% endif %}
        </div>
        
        <button class="action-button write-button">
          <span>Написать</span>
        </button>
      </div>

      <div class="form-column startup-info-column">
        <!-- Название и рейтинг -->
        <h1 class="startup-name">{{ startup.title }}</h1>
        <div class="category-label">Категория: {{ startup.direction.direction_name|default:"Досуг" }}</div>
        
        <div class="rating-section">
          <span class="rating-text">Рейтинг {{ average_rating|floatformat:"1" }}/5</span>
          <div class="rating-stars">
            {% for i in "12345" %}
              <i class="fas fa-star {% if forloop.counter <= average_rating %}active{% endif %}"></i>
            {% endfor %}
          </div>
        </div>
        
        <div class="funding-info">
          <h3 class="funding-label">Цель/стоимость выкупа</h3>
          <div class="funding-amount">{{ startup.funding_goal|default:"41 689" }} ₽</div>
        </div>
        
        <div class="statistics">
          <div class="stats-item">
            <i class="far fa-comment"></i>
            <span>{{ startup.total_voters|default:"213" }}</span>
          </div>
          <div class="stats-item">
            <i class="far fa-heart"></i>
            <span>{{ startup.likes_count|default:"17" }}</span>
          </div>
        </div>
        
        <div class="author-info">
          <div class="author-avatar"></div>
          <div class="author-details">
            <span class="author-name">{{ startup.owner.first_name|default:"Виктор" }}</span>
            <span class="author-rating">Рейтинг {{ average_rating|floatformat:"1" }}/5</span>
            <span class="author-reviews">Отзывы</span>
          </div>
        </div>
      </div>
      
      <div class="form-column investment-column">
        <div class="investment-container">
          <!-- Инвестиции -->
          <div class="investment-badge">
            <span>Инвестиции</span>
            <i class="fas fa-chevron-down"></i>
          </div>
          
          <button class="action-button invest-button">
            <span>Инвестировать</span>
          </button>
          
          <div class="investors-count">
            <i class="fas fa-users"></i>
            <span>Инвестировало (648)</span>
          </div>
        </div>
      </div>
    </div>

    <!-- О проекте -->
    <div class="about-section">
      <h2 class="section-title">О проекте</h2>
      <div class="about-content">
        <p class="about-text">{{ startup.description }}</p>
        <span class="read-more">Читать дальше</span>
      </div>
    </div>

    <!-- Галерея -->
    <div class="images-gallery">
      {% for url in creatives_urls|slice:":4" %}
        <div class="gallery-item">
          <img src="{% get_file_url_tag url startup.startup_id 'creative' %}" alt="Креатив">
        </div>
      {% empty %}
        {% for i in "1234" %}
          <div class="gallery-item"></div>
        {% endfor %}
      {% endfor %}
    </div>
    <div class="gallery-main">
      {% if creatives_urls %}
        <img src="{% get_file_url_tag creatives_urls.0 startup.startup_id 'creative' %}" alt="Главное изображение">
      {% endif %}
    </div>

    <!-- Условия для инвестора -->
    <div class="investor-conditions">
      <h2 class="section-title">Условия для инвестора</h2>
      <div class="about-content">
        <p class="about-text">Договоры займа сроком на 12 месяцев, выплаты — ежемесячно. 
        Минимальный порог — {{ startup.min_investment|default:"500 000" }} ₽;
        - от {{ startup.min_investment|default:"500 000" }} ₽ — {{ startup.interest_rate|default:"50" }}% годовых.</p>
        <span class="read-more">Читать дальше</span>
      </div>
    </div>

    <!-- Документы -->
    <div class="documents-section">
      <h2 class="section-title">Документы</h2>
      <div class="documents-grid">
        {% if startup.proofs_urls %}
          {% for url in proofs_urls %}
            {% if forloop.counter == 1 %}
              <a href="{% get_file_url_tag url startup.startup_id 'proof' %}" target="_blank" class="document-item document-pdf">PDF</a>
            {% elif forloop.counter == 2 %}
              <a href="{% get_file_url_tag url startup.startup_id 'proof' %}" target="_blank" class="document-item document-excel">EXCEL</a>
            {% elif forloop.counter == 3 %}
              <a href="{% get_file_url_tag url startup.startup_id 'proof' %}" target="_blank" class="document-item document-doc">DOC</a>
            {% endif %}
          {% endfor %}
        {% else %}
          <div class="document-item document-pdf">PDF</div>
          <div class="document-item document-excel">EXCEL</div>
          <div class="document-item document-doc">DOC</div>
        {% endif %}
      </div>
    </div>

    <!-- Профиль автора -->
    <div class="author-profile">
      <div class="author-info-large">
        <div class="author-avatar"></div>
        <div class="author-details">
          <span class="author-name">{{ startup.owner.first_name|default:"Виктор" }}</span>
          <span class="author-rating">Рейтинг {{ average_rating|floatformat:"1" }}/5</span>
          <span class="author-reviews">Отзывы</span>
        </div>
      </div>
      <button class="action-button">
        <span>Написать автору</span>
      </button>
    </div>

    <!-- Дополнительная информация -->
    <div class="additional-info">
      <span class="creation-date">Создан {{ startup.created_at|date:"d/m/Y" }}</span>
      <button class="report-button">Пожаловаться на стартап</button>
    </div>
    
    <!-- Комментарии -->
    <div class="comments-section">
      <h2 class="comments-title">Комментарии</h2>
      <div class="comments-stats">
        <div class="stats-item">
          <i class="far fa-comment"></i>
          <span>{{ comments_count|default:"213" }}</span>
        </div>
        <div class="stats-item">
          <i class="far fa-heart"></i>
          <span>{{ likes_count|default:"17" }}</span>
        </div>
      </div>
      
      <button class="action-button comment-button">
        <span>Оставить комментарий</span>
      </button>
      
      <div class="comments-list">
        <div class="comment-card">
          <div class="comment-row">
            <div class="comment-user">
              <div class="author-avatar"></div>
              <div class="comment-info">
                <div class="comment-author">Виктор</div>
                <div class="comment-text">Само направление сейчас актуально и я уже инвестировала в похожий стартап. Советую!</div>
              </div>
            </div>
            <div class="comment-meta">
              <div class="comment-date">25/07/2024</div>
              <div class="rating-stars small">
                {% for i in "12345" %}
                  <i class="fas fa-star active"></i>
                {% endfor %}
              </div>
              <div class="badge-invested">Инвестировал</div>
            </div>
          </div>
        </div>
        
        <div class="comment-card">
          <div class="comment-row">
            <div class="comment-user">
              <div class="author-avatar"></div>
              <div class="comment-info">
                <div class="comment-author">Сергей</div>
                <div class="comment-text">Само направление сейчас актуально и я уже инвестировала в похожий стартап. Советую!</div>
              </div>
            </div>
            <div class="comment-meta">
              <div class="comment-date">25/07/2024</div>
              <div class="rating-stars small">
                {% for i in "12345" %}
                  <i class="fas fa-star active"></i>
                {% endfor %}
              </div>
              <div class="badge-invested small">Выкуп</div>
            </div>
          </div>
        </div>
      </div>
      
      <button class="show-more-button">
        <i class="fas fa-eye"></i>
        <span>Показать еще</span>
      </button>
      
      <div class="comment-form">
        <textarea placeholder="Написать комментарий"></textarea>
        <button class="action-button comment-submit">
          <span>Оставить комментарий</span>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Здесь можно добавить дополнительный JavaScript функционал
  });
</script>
{% endblock %}